(()=>{"use strict";var e={338:function(e){e.exports=require("onoff")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o||"object"==typeof r&&r&&(4&o&&r.__esModule||16&o&&"function"==typeof r.then))return r;var i=Object.create(null);n.r(i);var u={};e=e||[null,t({}),t([]),t(t)];for(var a=2&o&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>{u[e]=()=>r[e]});return u.default=()=>r,n.d(i,u),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r),n.d(r,{default:()=>v}),require("dotenv/config");let e=require("elegant-queue");function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t,n,r,o,i,u){try{var a=e[i](u),l=a.value}catch(e){n(e);return}a.done?t(l):Promise.resolve(l).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var u=e.apply(t,n);function a(e){i(u,r,o,a,l,"next",e)}function l(e){i(u,r,o,a,l,"throw",e)}a(void 0)})}}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=a(0),u.throw=a(1),u.return=a(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(a){return function(l){var c=[a,l];if(n)throw TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var c=function(){var e;function n(e,r){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");t(this,"pin",void 0),t(this,"type",void 0),t(this,"status",void 0),this.pin=e,this.type=r,this.status=0}return e=[{key:"writeSync",value:function(e){console.log("Debug only.  This is only simulating pin control: Pin ".concat(this.pin," is being set from ").concat(this.status," to ").concat(e)),this.status=e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,e),n}(),s=1,f=1,d=1,p=1,b=new e.Queue,y=new c(Number(process.env.MOONDUNK_PIN),"out");function v(e){return u(function(){var t,r,o;return l(this,function(i){var v,h,g;switch(i.label){case 0:return e.log.info("Hello, from your bundle's extension!"),e.log.info("I'm where you put all your server-side code."),e.log.info('To edit me, open "'.concat(__filename.replace("build/extension","src/extension"),'" in your favorite text editor or IDE.')),[4,(v=e,u(function(){var e,t,r,o;return l(this,function(i){switch(i.label){case 0:if(s=null!=(e=v.bundleConfig.MOONDUNK_RATE)?e:1,f=null!=(t=v.bundleConfig.MOONDUNK_VOLUME)?t:1,d=null!=(r=v.bundleConfig.MOONDUNK_GOAL)?r:1,p=f/(s*d),null!=(o=v.bundleConfig.MOONDUNK_DEBUG)&&o)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.resolve().then(n.t.bind(n,338,23))];case 2:return c=i.sent().Gpio,[3,4];case 3:return i.sent(),console.log("could not use onoff library"),[3,4];case 4:return y=new c(v.bundleConfig.MOONDUNK_PIN,"out"),[2]}})})())];case 1:return i.sent(),t=e.Replicant("queueddonations"),r=e.Replicant("useddonationids"),o=e.Replicant("twitchsubs"),e.Replicant("faketotal"),e.Replicant("alldonations","tiltify-nodecg").on("change",function(e,n){var o=new Set(null!=(c=r.value)?c:[]),i=!0,u=!1,l=void 0;try{for(var c,s,f=(null!=e?e:[])[Symbol.iterator]();!(i=(s=f.next()).done);i=!0){var d=s.value;o.has(d.id)||(b.enqueue(d),t.value=a(b))}}catch(e){u=!0,l=e}finally{try{i||null==f.return||f.return()}finally{if(u)throw l}}}),e.listenFor("subscription","twitch-bundle",function(e){void 0==o.value?o.value=[e]:o.value=a(o.value).concat([e])}),e.listenFor("manualdono",function(e){console.log("i was here"),b.enqueue(e),t.value=a(b)}),h=t,g=r,u(function(){var e,t;return l(this,function(n){switch(n.label){case 0:var r;if(0==b.size())return[3,2];return[4,(r=e=b.peek(),u(function(){var e,t;return l(this,function(n){switch(n.label){case 0:if(void 0==r)return[2];return t=(e=r.amountDisplay)*p,console.log("\n".concat(r.donor_name," donated $").concat(e," USD for ").concat(t," seconds of water")),y.writeSync(0),[4,function e(t,n,r){return u(function(){return l(this,function(o){switch(o.label){case 0:n(t),o.label=1;case 1:if(!(t>1e-4))return[3,4];return[4,new Promise(function(e){return setTimeout(e,1e3*r)})];case 2:return o.sent(),[4,e(Math.max(t-r,0),n,r)];case 3:return[2,o.sent()];case 4:return[2]}})})()}(t,function(e){process.stdout.clearLine(0),process.stdout.cursorTo(0),process.stdout.write("Dispensing water: ".concat(e.toFixed(2)))},.1)];case 1:return n.sent(),console.log(),y.writeSync(1),console.log("Water for ".concat(r.donor_name," finished dispensing")),[2]}})})())];case 1:n.sent(),b.dequeue(),h.value=a(b),g.value=a(null!=(t=null==g?void 0:g.value)?t:[]).concat([e.id]),n.label=2;case 2:return[4,u(function(){return l(this,function(e){return[2,new Promise(function(e){return setTimeout(e,100)})]})})()];case 3:return n.sent(),[3,0];case 4:return[2]}})})(),[2]}})})()}})(),module.exports=r})();
//# sourceMappingURL=index.js.map